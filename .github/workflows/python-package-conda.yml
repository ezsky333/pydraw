name: Daily Request

on:
  push:               # 在推送代码时触发
    branches:
      - main         # 替换为你的目标分支，通常是 main 或 master
  schedule:
    - cron: '50 0 * * *' # 每天00:00 (UTC) 执行

jobs:
  send_request:
    runs-on: ubuntu-latest

    steps:
      - name: Send POST request
        id: request_1
        run: |
          response=$(curl --location --request POST 'https://edu.definesys.cn/edu-api/forumSign/sign' \
          --header "Token: ${{ secrets.FORUM_TOKEN }}")
          echo "::set-output name=response::$response"
      - name: Evaluate response and send message for request 1
        run: |
          response='${{ steps.request_1.outputs.response }}'
          code=$(echo $response | jq -r '.code')
          message=$(echo $response | jq -r '.message')
          if [[ $code == "ok" ]]; then
            final_message="签到成功"
          else
            final_message="签到失败：$message"
          fi
          curl --location --request POST 'https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=${{ secrets.WECHAT_WORK_WEBHOOK_KEY }}' \
          --header 'Content-Type: application/json' \
          --data-raw "{\"msgtype\": \"text\", \"text\": {\"content\": \"一斩： $final_message\"}}"

      - name: Send POST request lin
        id: request_lin
        run: |
          response=$(curl --location --request POST 'https://edu.definesys.cn/edu-api/forumSign/sign' \
          --header "Token: ${{ secrets.FORUM_TOKEN_LIN }}")
          echo "::set-output name=response::$response"
      - name: Evaluate response and send message for request lin
        run: |
          response='${{ steps.request_lin.outputs.response }}'
          code=$(echo $response | jq -r '.code')
          message=$(echo $response | jq -r '.message')
          if [[ $code == "ok" ]]; then
            final_message="签到成功"
          else
            final_message="签到失败：$message"
          fi
          curl --location --request POST 'https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=${{ secrets.WECHAT_WORK_WEBHOOK_KEY }}' \
          --header 'Content-Type: application/json' \
          --data-raw "{\"msgtype\": \"text\", \"text\": {\"content\": \"林老师： $final_message\"}}"

      - name: Send POST request wang
        id: request_wang
        run: |
          response=$(curl --location --request POST 'https://edu.definesys.cn/edu-api/forumSign/sign' \
          --header "Token: ${{ secrets.FORUM_TOKEN_WANG }}")
          echo "::set-output name=response::$response"
      - name: Evaluate response and send message for request wang
        run: |
          response='${{ steps.request_wang.outputs.response }}'
          code=$(echo $response | jq -r '.code')
          message=$(echo $response | jq -r '.message')
          if [[ $code == "ok" ]]; then
            final_message="签到成功"
          else
            final_message="签到失败：$message"
          fi
          curl --location --request POST 'https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=${{ secrets.WECHAT_WORK_WEBHOOK_KEY }}' \
          --header 'Content-Type: application/json' \
          --data-raw "{\"msgtype\": \"text\", \"text\": {\"content\": \"王老师： $final_message\"}}"
